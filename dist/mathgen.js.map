{"version":3,"sources":["../mathgen.js"],"names":["Array","prototype","removeIndex","index","splice","String","afterLast","separator","lastIndexOf","slice","trimEnd","char","replace","RegExp","uploadJSON","json","callback","console","log","data","JSON","stringify","xhr","XMLHttpRequest","addEventListener","readyState","parse","responseText","uri","open","setRequestHeader","send","downloadJSON","id","ts","Typeson","register","Operator","Addition","Subtraction","Multiplication","Division","RandRange","RandRangeAdv","OperatorGen","Generator","Expression","x","expr","source","Rule","rule","generator","hist","app","Vue","el","showHelp","methods","addOperator","operator","operators","push","generate","results","$Message","success","length","save","$copyText","$Notice","title","desc","load","download","showLoadModal","$Modal","confirm","render","h","props","value","autofocus","placeholder","type","autosize","on","input","val","width","scrollable","onOk","share","encapsulate","nextTick","link","content","okText","removeDecimal","str","substr","indexOf","print","printJS","printable","toString","scanStyles","css","firstHalf","list","Math","floor","lastHalf","params","window","location","href"],"mappings":"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","file":"mathgen.js","sourcesContent":["Array.prototype.removeIndex = function(index) {\r\n    this.splice(index, 1);\r\n};\r\nString.prototype.afterLast = function(separator) {\r\n    const index = this.lastIndexOf(separator);\r\n    if (index !== -1) {\r\n        return this.slice(index + 1);\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n};\r\nString.prototype.trimEnd = function(char) {\r\n    return this.replace(new RegExp('\\\\'+char+'+$', 'g'), '');\r\n};\r\n\r\nfunction uploadJSON(json, callback = console.log) {\r\n    const data = JSON.stringify(json);\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.addEventListener('readystatechange', function () {\r\n        if (this.readyState === 4) {\r\n            callback(JSON.parse(this.responseText).uri);\r\n        }\r\n    });\r\n    xhr.open('POST', 'https://api.myjson.com/bins');\r\n    xhr.setRequestHeader('Content-Type', 'application/json');\r\n    xhr.setRequestHeader('cache-control', 'no-cache');\r\n    xhr.send(data);\r\n}\r\nfunction downloadJSON(id, callback = console.log) {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.addEventListener('readystatechange', function () {\r\n        if (this.readyState === 4) {\r\n            callback(this.responseText);\r\n        }\r\n    });\r\n    xhr.open('GET', 'https://api.myjson.com/bins/' + id);\r\n    xhr.send();\r\n}\r\n\r\nconst ts = new Typeson().register({\r\n    Operator:Operator,\r\n    Addition:Addition,\r\n    Subtraction:Subtraction,\r\n    Multiplication:Multiplication,\r\n    Division:Division,\r\n    RandRange:RandRange,\r\n    RandRangeAdv:RandRangeAdv,\r\n    OperatorGen:OperatorGen,\r\n    Generator:Generator,\r\n    Expression: [\r\n        x => x instanceof Expression,\r\n        expr => expr.source,\r\n        source => new Expression(source)\r\n    ],\r\n    Rule: [\r\n        x => x instanceof Rule,\r\n        rule => rule.source,\r\n        source => new Rule(source)\r\n    ]\r\n});\r\n\r\nlet generator = new Generator(1, 1, 10);\r\nlet hist = [];\r\n\r\nconst app = new Vue({\r\n    el: '#app',\r\n    data: {\r\n        generator: generator,\r\n        hist: hist,\r\n        showHelp: false\r\n    },\r\n    methods: {\r\n        addOperator: function (operator) {\r\n            generator.operators.push(new OperatorGen(operator, new RandRange(0, 100, 0, 100, false)));\r\n        },\r\n        generate: function () {\r\n            let results = generator.generate();\r\n            this.hist.push(results);\r\n            this.$Message.success(`成功生成${results.length}个算式`)\r\n        },\r\n        save: function () {\r\n            let json = ts.stringify(generator);\r\n            this.$copyText(json);\r\n            this.$Notice.open({\r\n                title: 'JSON数据 - 已复制到剪贴板',\r\n                desc: json,\r\n            });\r\n        },\r\n        load: function (json) {\r\n            generator = this.generator = ts.parse(json);\r\n            this.$Message.success('已加载JSON');\r\n        },\r\n        download: function(id) {\r\n            downloadJSON(id, (json) => this.load(json));\r\n        },\r\n        showLoadModal: function () {\r\n            this.$Modal.confirm({\r\n                render: (h) => {\r\n                    return h('Input', {\r\n                        props: {\r\n                            value: this.value,\r\n                            autofocus: true,\r\n                            placeholder: 'JSON数据',\r\n                            type: 'textarea',\r\n                            autosize: true\r\n                        },\r\n                        on: {\r\n                            input: (val) => {\r\n                                this.value = val;\r\n                            }\r\n                        }\r\n                    })\r\n                },\r\n                width: 800,\r\n                scrollable: true,\r\n                onOk: () => this.load(this.value)\r\n            })\r\n        },\r\n        share: function () {\r\n            uploadJSON(ts.encapsulate(generator), link => Vue.nextTick(() => {\r\n                console.log(link);\r\n                link = 'https://wenghy.me/mathgen/?' + link.trimEnd('/').afterLast('/');\r\n                this.$Modal.confirm({\r\n                    title: '分享成功!',\r\n                    content: link,\r\n                    okText: '复制链接',\r\n                    onOk: () => {\r\n                        this.$copyText(link);\r\n                    }\r\n                });\r\n            }));\r\n        },\r\n        removeDecimal: str => str.substr(0, str.indexOf('.')),\r\n        print: function (index) {\r\n            printJS({\r\n                printable: 'history' + index.toString(),\r\n                type: 'html',\r\n                scanStyles: false,\r\n                css: 'print.css'\r\n            })\r\n        },\r\n        firstHalf: (list) => list.slice(0, Math.floor(list.length / 2)),\r\n        lastHalf: (list) => list.slice(Math.floor(list.length / 2)),\r\n    }\r\n});\r\n\r\nconst params = window.location.href.afterLast('?');\r\nif (params != null) {\r\n    app.download(params);\r\n}"]}